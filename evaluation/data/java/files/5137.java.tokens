package io . netty . channel . epoll ; import io . netty . channel . Channel ; import io . netty . channel . unix . DomainSocketAddress ; import io . netty . channel . unix . FileDescriptor ; import io . netty . channel . unix . ServerDomainSocketChannel ; import io . netty . channel . unix . Socket ; import io . netty . util . internal . logging . InternalLogger ; import io . netty . util . internal . logging . InternalLoggerFactory ; import java . io . File ; import java . net . SocketAddress ; import static io . netty . channel . unix . Socket . newSocketDomain ; public final class EpollServerDomainSocketChannel extends AbstractEpollServerChannel implements ServerDomainSocketChannel { private static final InternalLogger logger = InternalLoggerFactory . getInstance ( EpollServerDomainSocketChannel . class ) ; private final EpollServerChannelConfig config = new EpollServerChannelConfig ( this ) ; private volatile DomainSocketAddress local ; public EpollServerDomainSocketChannel ( ) { super ( newSocketDomain ( ) , false ) ; } public EpollServerDomainSocketChannel ( FileDescriptor fd ) { super ( fd ) ; } public EpollServerDomainSocketChannel ( Socket fd ) { super ( fd ) ; } public EpollServerDomainSocketChannel ( Socket fd , boolean active ) { super ( fd , active ) ; } @Override protected Channel newChildChannel ( int fd , byte [ ] addr , int offset , int len ) throws Exception { return new EpollDomainSocketChannel ( this , new Socket ( fd ) ) ; } @Override protected DomainSocketAddress localAddress0 ( ) { return local ; } @Override protected void doBind ( SocketAddress localAddress ) throws Exception { fd ( ) . bind ( localAddress ) ; fd ( ) . listen ( config . getBacklog ( ) ) ; local = ( DomainSocketAddress ) localAddress ; } @Override protected void doClose ( ) throws Exception { try { super . doClose ( ) ; } finally { DomainSocketAddress local = this . local ; if ( local ! = null ) { File socketFile = new File ( local . path ( ) ) ; boolean success = socketFile . delete ( ) ; if ( ! success & & logger . isDebugEnabled ( ) ) { logger . debug ( <str> , local . path ( ) ) ; } } } } @Override public EpollServerChannelConfig config ( ) { return config ; } @Override public DomainSocketAddress remoteAddress ( ) { return ( DomainSocketAddress ) super . remoteAddress ( ) ; } @Override public DomainSocketAddress localAddress ( ) { return ( DomainSocketAddress ) super . localAddress ( ) ; } }