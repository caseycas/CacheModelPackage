package com . badlogic . gdx . backends . gwt . widgets ; import java . util . HashMap ; import java . util . Iterator ; import java . util . Map ; import com . google . gwt . event . logical . shared . ResizeEvent ; import com . google . gwt . event . logical . shared . ResizeHandler ; import com . google . gwt . event . shared . HandlerRegistration ; import com . google . gwt . user . client . Timer ; import com . google . gwt . user . client . Window ; import com . google . gwt . user . client . WindowResizeListener ; public class ResizableWidgetCollection implements ResizeHandler , Iterable < ResizableWidget > { static class ResizableWidgetInfo { private ResizableWidget widget ; private int curOffsetHeight = <int> ; private int curOffsetWidth = <int> ; private int curClientHeight = <int> ; private int curClientWidth = <int> ; public ResizableWidgetInfo ( ResizableWidget widget ) { this . widget = widget ; updateSizes ( ) ; } public int getClientHeight ( ) { return curClientHeight ; } public int getClientWidth ( ) { return curClientWidth ; } public int getOffsetHeight ( ) { return curOffsetHeight ; } public int getOffsetWidth ( ) { return curOffsetWidth ; } public boolean updateSizes ( ) { int offsetWidth = widget . getElement ( ) . getOffsetWidth ( ) ; int offsetHeight = widget . getElement ( ) . getOffsetHeight ( ) ; int clientWidth = widget . getElement ( ) . getClientWidth ( ) ; int clientHeight = widget . getElement ( ) . getClientHeight ( ) ; if ( offsetWidth ! = curOffsetWidth | | offsetHeight ! = curOffsetHeight | | clientWidth ! = curClientWidth | | clientHeight ! = curClientHeight ) { this . curOffsetWidth = offsetWidth ; this . curOffsetHeight = offsetHeight ; this . curClientWidth = clientWidth ; this . curClientHeight = clientHeight ; return true ; } return false ; } } private static final int DEFAULT_RESIZE_CHECK_DELAY = <int> ; private static ResizableWidgetCollection staticCollection = null ; public static ResizableWidgetCollection get ( ) { if ( staticCollection = = null ) { staticCollection = new ResizableWidgetCollection ( ) ; } return staticCollection ; } private Timer resizeCheckTimer = new Timer ( ) { @Override public void run ( ) { if ( windowHeight ! = Window . getClientHeight ( ) | | windowWidth ! = Window . getClientWidth ( ) ) { windowHeight = Window . getClientHeight ( ) ; windowWidth = Window . getClientWidth ( ) ; schedule ( resizeCheckDelay ) ; return ; } checkWidgetSize ( ) ; if ( resizeCheckingEnabled ) { schedule ( resizeCheckDelay ) ; } } } ; private Map < ResizableWidget , ResizableWidgetInfo > widgets = new HashMap < ResizableWidget , ResizableWidgetInfo > ( ) ; int windowHeight = <int> ; int windowWidth = <int> ; private HandlerRegistration windowHandler ; int resizeCheckDelay = DEFAULT_RESIZE_CHECK_DELAY ; boolean resizeCheckingEnabled ; public ResizableWidgetCollection ( ) { this ( DEFAULT_RESIZE_CHECK_DELAY ) ; } public ResizableWidgetCollection ( boolean resizeCheckingEnabled ) { this ( DEFAULT_RESIZE_CHECK_DELAY , resizeCheckingEnabled ) ; } public ResizableWidgetCollection ( int resizeCheckDelay ) { this ( resizeCheckDelay , true ) ; } protected ResizableWidgetCollection ( int resizeCheckDelay , boolean resizeCheckingEnabled ) { setResizeCheckDelay ( resizeCheckDelay ) ; setResizeCheckingEnabled ( resizeCheckingEnabled ) ; } public void add ( ResizableWidget widget ) { widgets . put ( widget , new ResizableWidgetInfo ( widget ) ) ; } public void checkWidgetSize ( ) { for ( Map . Entry < ResizableWidget , ResizableWidgetInfo > entry : widgets . entrySet ( ) ) { ResizableWidget widget = entry . getKey ( ) ; ResizableWidgetInfo info = entry . getValue ( ) ; if ( info . updateSizes ( ) ) { if ( info . getOffsetWidth ( ) > <int> & & info . getOffsetHeight ( ) > <int> & & widget . isAttached ( ) ) { widget . onResize ( info . getOffsetWidth ( ) , info . getOffsetHeight ( ) ) ; } } } } public int getResizeCheckDelay ( ) { return resizeCheckDelay ; } public boolean isResizeCheckingEnabled ( ) { return resizeCheckingEnabled ; } public Iterator < ResizableWidget > iterator ( ) { return widgets . keySet ( ) . iterator ( ) ; } public void remove ( ResizableWidget widget ) { widgets . remove ( widget ) ; } public void setResizeCheckDelay ( int resizeCheckDelay ) { this . resizeCheckDelay = resizeCheckDelay ; } public void setResizeCheckingEnabled ( boolean enabled ) { if ( enabled & & ! resizeCheckingEnabled ) { resizeCheckingEnabled = true ; if ( windowHandler = = null ) { windowHandler = Window . addResizeHandler ( this ) ; } resizeCheckTimer . schedule ( resizeCheckDelay ) ; } else if ( ! enabled & & resizeCheckingEnabled ) { resizeCheckingEnabled = false ; if ( windowHandler ! = null ) { windowHandler . removeHandler ( ) ; windowHandler = null ; } resizeCheckTimer . cancel ( ) ; } } public void updateWidgetSize ( ResizableWidget widget ) { if ( ! widget . isAttached ( ) ) { return ; } ResizableWidgetInfo info = widgets . get ( widget ) ; if ( info ! = null ) { info . updateSizes ( ) ; } } @Override public void onResize ( ResizeEvent event ) { checkWidgetSize ( ) ; } } 
