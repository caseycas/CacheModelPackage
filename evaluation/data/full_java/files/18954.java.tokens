package io . netty . handler . codec . string ; import io . netty . buffer . ByteBuf ; import io . netty . buffer . ByteBufUtil ; import io . netty . channel . ChannelHandler . Sharable ; import io . netty . channel . ChannelHandlerContext ; import io . netty . channel . ChannelPipeline ; import io . netty . handler . codec . LineBasedFrameDecoder ; import io . netty . handler . codec . MessageToMessageEncoder ; import java . nio . CharBuffer ; import java . nio . charset . Charset ; import java . util . List ; @Sharable public class StringEncoder extends MessageToMessageEncoder < CharSequence > { private final Charset charset ; public StringEncoder ( ) { this ( Charset . defaultCharset ( ) ) ; } public StringEncoder ( Charset charset ) { if ( charset = = null ) { throw new NullPointerException ( <str> ) ; } this . charset = charset ; } @Override protected void encode ( ChannelHandlerContext ctx , CharSequence msg , List < Object > out ) throws Exception { if ( msg . length ( ) = = <int> ) { return ; } out . add ( ByteBufUtil . encodeString ( ctx . alloc ( ) , CharBuffer . wrap ( msg ) , charset ) ) ; } } 
