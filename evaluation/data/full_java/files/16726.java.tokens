package com . badlogic . gdx . backends . android ; import java . io . IOException ; import android . media . MediaPlayer ; import com . badlogic . gdx . Gdx ; import com . badlogic . gdx . audio . Music ; public class AndroidMusic implements Music , MediaPlayer . OnCompletionListener { private final AndroidAudio audio ; private MediaPlayer player ; private boolean isPrepared = true ; protected boolean wasPlaying = false ; private float volume = <float> ; protected OnCompletionListener onCompletionListener ; AndroidMusic ( AndroidAudio audio , MediaPlayer player ) { this . audio = audio ; this . player = player ; this . onCompletionListener = null ; this . player . setOnCompletionListener ( this ) ; } @Override public void dispose ( ) { if ( player = = null ) return ; try { player . release ( ) ; } catch ( Throwable t ) { Gdx . app . log ( <str> , <str> ) ; } finally { player = null ; onCompletionListener = null ; synchronized ( audio . musics ) { audio . musics . remove ( this ) ; } } } @Override public boolean isLooping ( ) { if ( player = = null ) return false ; return player . isLooping ( ) ; } @Override public boolean isPlaying ( ) { if ( player = = null ) return false ; return player . isPlaying ( ) ; } @Override public void pause ( ) { if ( player = = null ) return ; if ( player . isPlaying ( ) ) { player . pause ( ) ; } wasPlaying = false ; } @Override public void play ( ) { if ( player = = null ) return ; if ( player . isPlaying ( ) ) return ; try { if ( ! isPrepared ) { player . prepare ( ) ; isPrepared = true ; } player . start ( ) ; } catch ( IllegalStateException e ) { e . printStackTrace ( ) ; } catch ( IOException e ) { e . printStackTrace ( ) ; } } @Override public void setLooping ( boolean isLooping ) { if ( player = = null ) return ; player . setLooping ( isLooping ) ; } @Override public void setVolume ( float volume ) { if ( player = = null ) return ; player . setVolume ( volume , volume ) ; this . volume = volume ; } @Override public float getVolume ( ) { return volume ; } @Override public void setPan ( float pan , float volume ) { if ( player = = null ) return ; float leftVolume = volume ; float rightVolume = volume ; if ( pan < <int> ) { rightVolume * = ( <int> - Math . abs ( pan ) ) ; } else if ( pan > <int> ) { leftVolume * = ( <int> - Math . abs ( pan ) ) ; } player . setVolume ( leftVolume , rightVolume ) ; this . volume = volume ; } @Override public void stop ( ) { if ( player = = null ) return ; if ( isPrepared ) { player . seekTo ( <int> ) ; } player . stop ( ) ; isPrepared = false ; } public void setPosition ( float position ) { if ( player = = null ) return ; try { if ( ! isPrepared ) { player . prepare ( ) ; isPrepared = true ; } player . seekTo ( ( int ) ( position * <int> ) ) ; } catch ( IllegalStateException e ) { e . printStackTrace ( ) ; } catch ( IOException e ) { e . printStackTrace ( ) ; } } @Override public float getPosition ( ) { if ( player = = null ) return <float> ; return player . getCurrentPosition ( ) / <int> f ; } public float getDuration ( ) { if ( player = = null ) return <float> ; return player . getDuration ( ) / <int> f ; } @Override public void setOnCompletionListener ( OnCompletionListener listener ) { onCompletionListener = listener ; } @Override public void onCompletion ( MediaPlayer mp ) { if ( onCompletionListener ! = null ) { Gdx . app . postRunnable ( new Runnable ( ) { @Override public void run ( ) { onCompletionListener . onCompletion ( AndroidMusic . this ) ; } } ) ; } } ; } 
