package org . elasticsearch . action . admin . indices . segments ; import org . elasticsearch . cluster . routing . ShardRouting ; import org . elasticsearch . common . io . stream . StreamInput ; import org . elasticsearch . common . io . stream . StreamOutput ; import org . elasticsearch . common . io . stream . Streamable ; import org . elasticsearch . index . engine . Segment ; import java . io . IOException ; import java . util . ArrayList ; import java . util . Collections ; import java . util . Iterator ; import java . util . List ; import static org . elasticsearch . cluster . routing . ShardRouting . readShardRoutingEntry ; public class ShardSegments implements Streamable , Iterable < Segment > { private ShardRouting shardRouting ; private List < Segment > segments ; ShardSegments ( ) { } ShardSegments ( ShardRouting shardRouting , List < Segment > segments ) { this . shardRouting = shardRouting ; this . segments = segments ; } @Override public Iterator < Segment > iterator ( ) { return segments . iterator ( ) ; } public ShardRouting getShardRouting ( ) { return this . shardRouting ; } public List < Segment > getSegments ( ) { return this . segments ; } public int getNumberOfCommitted ( ) { int count = <int> ; for ( Segment segment : segments ) { if ( segment . isCommitted ( ) ) { count + + ; } } return count ; } public int getNumberOfSearch ( ) { int count = <int> ; for ( Segment segment : segments ) { if ( segment . isSearch ( ) ) { count + + ; } } return count ; } public static ShardSegments readShardSegments ( StreamInput in ) throws IOException { ShardSegments shard = new ShardSegments ( ) ; shard . readFrom ( in ) ; return shard ; } @Override public void readFrom ( StreamInput in ) throws IOException { shardRouting = readShardRoutingEntry ( in ) ; int size = in . readVInt ( ) ; if ( size = = <int> ) { segments = Collections . emptyList ( ) ; } else { segments = new ArrayList < > ( size ) ; for ( int i = <int> ; i < size ; i + + ) { segments . add ( Segment . readSegment ( in ) ) ; } } } @Override public void writeTo ( StreamOutput out ) throws IOException { shardRouting . writeTo ( out ) ; out . writeVInt ( segments . size ( ) ) ; for ( Segment segment : segments ) { segment . writeTo ( out ) ; } } } 
