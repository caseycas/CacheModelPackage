package org . junit . runner ; import java . io . IOException ; import java . io . ObjectInputStream ; import java . io . ObjectOutputStream ; import java . io . ObjectStreamClass ; import java . io . ObjectStreamField ; import java . io . Serializable ; import java . util . ArrayList ; import java . util . Collections ; import java . util . List ; import java . util . concurrent . CopyOnWriteArrayList ; import java . util . concurrent . atomic . AtomicInteger ; import java . util . concurrent . atomic . AtomicLong ; import org . junit . runner . notification . Failure ; import org . junit . runner . notification . RunListener ; public class Result implements Serializable { private static final long serialVersionUID = <int> ; private static final ObjectStreamField [ ] serialPersistentFields = ObjectStreamClass . lookup ( SerializedForm . class ) . getFields ( ) ; private final AtomicInteger count ; private final AtomicInteger ignoreCount ; private final CopyOnWriteArrayList < Failure > failures ; private final AtomicLong runTime ; private final AtomicLong startTime ; private SerializedForm serializedForm ; public Result ( ) { count = new AtomicInteger ( ) ; ignoreCount = new AtomicInteger ( ) ; failures = new CopyOnWriteArrayList < Failure > ( ) ; runTime = new AtomicLong ( ) ; startTime = new AtomicLong ( ) ; } private Result ( SerializedForm serializedForm ) { count = serializedForm . fCount ; ignoreCount = serializedForm . fIgnoreCount ; failures = new CopyOnWriteArrayList < Failure > ( serializedForm . fFailures ) ; runTime = new AtomicLong ( serializedForm . fRunTime ) ; startTime = new AtomicLong ( serializedForm . fStartTime ) ; } public int getRunCount ( ) { return count . get ( ) ; } public int getFailureCount ( ) { return failures . size ( ) ; } public long getRunTime ( ) { return runTime . get ( ) ; } public List < Failure > getFailures ( ) { return failures ; } public int getIgnoreCount ( ) { return ignoreCount . get ( ) ; } public boolean wasSuccessful ( ) { return getFailureCount ( ) = = <int> ; } private void writeObject ( ObjectOutputStream s ) throws IOException { SerializedForm serializedForm = new SerializedForm ( this ) ; serializedForm . serialize ( s ) ; } private void readObject ( ObjectInputStream s ) throws ClassNotFoundException , IOException { serializedForm = SerializedForm . deserialize ( s ) ; } private Object readResolve ( ) { return new Result ( serializedForm ) ; } @RunListener.ThreadSafe private class Listener extends RunListener { @Override public void testRunStarted ( Description description ) throws Exception { startTime . set ( System . currentTimeMillis ( ) ) ; } @Override public void testRunFinished ( Result result ) throws Exception { long endTime = System . currentTimeMillis ( ) ; runTime . addAndGet ( endTime - startTime . get ( ) ) ; } @Override public void testFinished ( Description description ) throws Exception { count . getAndIncrement ( ) ; } @Override public void testFailure ( Failure failure ) throws Exception { failures . add ( failure ) ; } @Override public void testIgnored ( Description description ) throws Exception { ignoreCount . getAndIncrement ( ) ; } @Override public void testAssumptionFailure ( Failure failure ) { } } public RunListener createListener ( ) { return new Listener ( ) ; } private static class SerializedForm implements Serializable { private static final long serialVersionUID = <int> ; private final AtomicInteger fCount ; private final AtomicInteger fIgnoreCount ; private final List < Failure > fFailures ; private final long fRunTime ; private final long fStartTime ; public SerializedForm ( Result result ) { fCount = result . count ; fIgnoreCount = result . ignoreCount ; fFailures = Collections . synchronizedList ( new ArrayList < Failure > ( result . failures ) ) ; fRunTime = result . runTime . longValue ( ) ; fStartTime = result . startTime . longValue ( ) ; } @SuppressWarnings ( <str> ) private SerializedForm ( ObjectInputStream . GetField fields ) throws IOException { fCount = ( AtomicInteger ) fields . get ( <str> , null ) ; fIgnoreCount = ( AtomicInteger ) fields . get ( <str> , null ) ; fFailures = ( List < Failure > ) fields . get ( <str> , null ) ; fRunTime = fields . get ( <str> , <int> L ) ; fStartTime = fields . get ( <str> , <int> L ) ; } public void serialize ( ObjectOutputStream s ) throws IOException { ObjectOutputStream . PutField fields = s . putFields ( ) ; fields . put ( <str> , fCount ) ; fields . put ( <str> , fIgnoreCount ) ; fields . put ( <str> , fFailures ) ; fields . put ( <str> , fRunTime ) ; fields . put ( <str> , fStartTime ) ; s . writeFields ( ) ; } public static SerializedForm deserialize ( ObjectInputStream s ) throws ClassNotFoundException , IOException { ObjectInputStream . GetField fields = s . readFields ( ) ; return new SerializedForm ( fields ) ; } } } 
