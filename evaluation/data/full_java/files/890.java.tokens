package org . apache . cassandra . schema ; import java . util . Iterator ; import java . util . Optional ; import javax . annotation . Nullable ; import com . google . common . collect . ImmutableMap ; import com . google . common . collect . MapDifference ; import com . google . common . collect . Maps ; import org . apache . cassandra . config . CFMetaData ; import static com . google . common . collect . Iterables . filter ; public final class Tables implements Iterable < CFMetaData > { private final ImmutableMap < String , CFMetaData > tables ; private Tables ( Builder builder ) { tables = builder . tables . build ( ) ; } public static Builder builder ( ) { return new Builder ( ) ; } public static Tables none ( ) { return builder ( ) . build ( ) ; } public static Tables of ( CFMetaData . . . tables ) { return builder ( ) . add ( tables ) . build ( ) ; } public static Tables of ( Iterable < CFMetaData > tables ) { return builder ( ) . add ( tables ) . build ( ) ; } public Iterator < CFMetaData > iterator ( ) { return tables . values ( ) . iterator ( ) ; } public int size ( ) { return tables . size ( ) ; } public Optional < CFMetaData > get ( String name ) { return Optional . ofNullable ( tables . get ( name ) ) ; } @Nullable public CFMetaData getNullable ( String name ) { return tables . get ( name ) ; } public Tables with ( CFMetaData table ) { if ( get ( table . cfName ) . isPresent ( ) ) throw new IllegalStateException ( String . format ( <str> , table . cfName ) ) ; return builder ( ) . add ( this ) . add ( table ) . build ( ) ; } public Tables without ( String name ) { CFMetaData table = get ( name ) . orElseThrow ( ( ) - > new IllegalStateException ( String . format ( <str> , name ) ) ) ; return builder ( ) . add ( filter ( this , t - > t ! = table ) ) . build ( ) ; } MapDifference < String , CFMetaData > diff ( Tables other ) { return Maps . difference ( tables , other . tables ) ; } @Override public boolean equals ( Object o ) { return this = = o | | ( o instanceof Tables & & tables . equals ( ( ( Tables ) o ) . tables ) ) ; } @Override public int hashCode ( ) { return tables . hashCode ( ) ; } @Override public String toString ( ) { return tables . values ( ) . toString ( ) ; } public static final class Builder { final ImmutableMap . Builder < String , CFMetaData > tables = new ImmutableMap . Builder < > ( ) ; private Builder ( ) { } public Tables build ( ) { return new Tables ( this ) ; } public Builder add ( CFMetaData table ) { tables . put ( table . cfName , table ) ; return this ; } public Builder add ( CFMetaData . . . tables ) { for ( CFMetaData table : tables ) add ( table ) ; return this ; } public Builder add ( Iterable < CFMetaData > tables ) { tables . forEach ( this : : add ) ; return this ; } } } 
