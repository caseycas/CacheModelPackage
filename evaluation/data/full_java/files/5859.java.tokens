package org . elasticsearch . common . inject . internal ; import org . elasticsearch . common . inject . Binder ; import org . elasticsearch . common . inject . Injector ; import org . elasticsearch . common . inject . Key ; import org . elasticsearch . common . inject . Provider ; import org . elasticsearch . common . inject . spi . BindingTargetVisitor ; import org . elasticsearch . common . inject . spi . Dependency ; import org . elasticsearch . common . inject . spi . HasDependencies ; import org . elasticsearch . common . inject . spi . InjectionPoint ; import org . elasticsearch . common . inject . spi . ProviderInstanceBinding ; import java . util . HashSet ; import java . util . Set ; import static java . util . Collections . unmodifiableSet ; public final class ProviderInstanceBindingImpl < T > extends BindingImpl < T > implements ProviderInstanceBinding < T > { final Provider < ? extends T > providerInstance ; final Set < InjectionPoint > injectionPoints ; public ProviderInstanceBindingImpl ( Injector injector , Key < T > key , Object source , InternalFactory < ? extends T > internalFactory , Scoping scoping , Provider < ? extends T > providerInstance , Set < InjectionPoint > injectionPoints ) { super ( injector , key , source , internalFactory , scoping ) ; this . providerInstance = providerInstance ; this . injectionPoints = injectionPoints ; } public ProviderInstanceBindingImpl ( Object source , Key < T > key , Scoping scoping , Set < InjectionPoint > injectionPoints , Provider < ? extends T > providerInstance ) { super ( source , key , scoping ) ; this . injectionPoints = injectionPoints ; this . providerInstance = providerInstance ; } @Override public < V > V acceptTargetVisitor ( BindingTargetVisitor < ? super T , V > visitor ) { return visitor . visit ( this ) ; } @Override public Provider < ? extends T > getProviderInstance ( ) { return providerInstance ; } @Override public Set < InjectionPoint > getInjectionPoints ( ) { return injectionPoints ; } @Override public Set < Dependency < ? > > getDependencies ( ) { return providerInstance instanceof HasDependencies ? unmodifiableSet ( new HashSet < > ( ( ( ( HasDependencies ) providerInstance ) . getDependencies ( ) ) ) ) : Dependency . forInjectionPoints ( injectionPoints ) ; } @Override public BindingImpl < T > withScoping ( Scoping scoping ) { return new ProviderInstanceBindingImpl < > ( getSource ( ) , getKey ( ) , scoping , injectionPoints , providerInstance ) ; } @Override public BindingImpl < T > withKey ( Key < T > key ) { return new ProviderInstanceBindingImpl < > ( getSource ( ) , key , getScoping ( ) , injectionPoints , providerInstance ) ; } @Override public void applyTo ( Binder binder ) { getScoping ( ) . applyTo ( binder . withSource ( getSource ( ) ) . bind ( getKey ( ) ) . toProvider ( getProviderInstance ( ) ) ) ; } @Override public String toString ( ) { return new ToStringBuilder ( ProviderInstanceBinding . class ) . add ( <str> , getKey ( ) ) . add ( <str> , getSource ( ) ) . add ( <str> , getScoping ( ) ) . add ( <str> , providerInstance ) . toString ( ) ; } } 
